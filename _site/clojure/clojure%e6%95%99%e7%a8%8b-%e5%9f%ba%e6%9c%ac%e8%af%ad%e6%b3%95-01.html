<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="keywords" content="clojure"/>
    <meta name="author" content="liyouhai.com"> 
    <link rel="canonical" href="http://liyouhai.com/clojure/clojure%25e6%2595%2599%25e7%25a8%258b-%25e5%259f%25ba%25e6%259c%25ac%25e8%25af%25ad%25e6%25b3%2595-01.html">
    <link href="http://liyouhai.com/rss.xml" title="RSS 2.0" type="application/rss+xml" rel="alternate"/>
    <link href="/img/favicon.ico" rel="icon" type="image/x-icon">
    <title>Clojure教程-基本语法-01 - IvanPig's Blog</title>
    <link rel="stylesheet" href="/css/min/pure-min.css">
    <!--[if lte IE 8]>
    <link rel="stylesheet" href="/css/min/grids-responsive-old-ie-min.css">
    <![endif]-->
    <!--[if gt IE 8]><!-->
    <link rel="stylesheet" href="/css/min/grids-responsive-min.css">
    <!--<![endif]-->

    <!--[if lte IE 8]>
    <link rel="stylesheet" href="/css/JekyllPure-old-ie.css">
    <![endif]-->
    <!--[if gt IE 8]><!-->
    <link rel="stylesheet" href="/css/JekyllPure.css">
    <!--<![endif]-->

    <link href="/css/min/font-awesome.min.css" rel="stylesheet">
    <!--[if lte IE 8]>
    <link rel="stylesheet" href="/css/min/font-awesome-ie7.min.css">
    <![endif]-->
    <script src="/js/min/jquery-1.7.2.min.js"></script>
    <!--
     /\_ \    __                         /\ \                __
     \//\ \  /\_\  __  __    ___   __  __\ \ \___      __   /\_\
       \ \ \ \/\ \/\ \/\ \  / __`\/\ \/\ \\ \  _ `\  /'__`\ \/\ \
        \_\ \_\ \ \ \ \_\ \/\ \L\ \ \ \_\ \\ \ \ \ \/\ \L\.\_\ \ \
        /\____\\ \_\/`____ \ \____/\ \____/ \ \_\ \_\ \__/.\_\\ \_\
        \/____/ \/_/`/___/> \/___/  \/___/   \/_/\/_/\/__/\/_/ \/_/
                       /\___/
                       \/__/
     图像可以到http://asciigen.com/  生成..记得翻墙才能正常生成.如不方便可以博客留言我帮你生成
     -->
</head>

<body>







<div id="layout" class="pure-g">
    <div class="sidebar pure-u-1 pure-u-md-1-4">
        <div class="header">
            <div class="headerpic">
                <a href="/">
                    <img src="/img/op.jpg" alt="Profile Picture" style="width: 140px;" title="返回首页">
                </a>
            </div>
            <!-- <h1 class="brand-title">IvanPig's Blog</h1>-->
            <h2 class="brand-tagline">IvanPig's Blog</h2>

            <nav class="nav">
                <ul class="nav-list">
                    <li class="nav-item">
                        <a class="pure-button" href="/Timing">时间轴</a>
                    </li>
                    <li class="nav-item">
                        <a class="pure-button" href="/tag">标签库</a>
                    </li>
                    <!--<li class="nav-item">
                        <a class="pure-button" href="/1">收藏站</a>
                    </li>
                    <li class="nav-item">
                        <a class="pure-button" href="/1">音乐屋</a>-->

                </ul>
            </nav>
            <div class="search">
                <form action="/search">
                    <input type="text" class="search-query" placeholder="Search Blog" name="query" title="全站搜索-只支持英文">
                </form>
            </div>
            <div id="toc"></div>
            <nav id="nav">
                <ul class="nav-list">
                    <li class="nav-link">
                    <a class="weibo "  href="http://weibo.com/1686537657/profile?topnav=1&wvr=6" ><i class="fa fa-weibo fa-2x"></i></a>
                    </li>
                    <li class="nav-link">
                    <a class="github" href="https://github.com/ivanpig"><i class="fa fa-github fa-2x"></i></a>
                    </li>
                    <li class="nav-link">
                    <a class="rss" href="/rss.xml" ><i class="fa fa-rss fa-2x"></i></a>
                    </li>
                </ul>
            </nav>
        </div>
    </div>

    <div class="content pure-u-1 pure-u-md-3-4">
        <!--[if lt IE 8]>
        <i class="label label-danger">亲爱的用户，您的浏览器版本过低，建议您升级浏览器获得更好的用户体验</i>
        <![endif]-->
        <div>
            <div class="posts">

                <div class="qrcodeTable"></div>
<header class="post-header">
    <img class="post-avatar" height="48" width="48"
         src="">

    <h2 class="post-title">Clojure教程-基本语法-01</h2>

    <p class="post-meta">By 12月20日  2013  



 
<a class="post-categorybut " href="/type/#"><i class="fa fa-folder-open"></i> clojure (11)</a>


  



		  
			 
<a class="post-category " href="/tag/#clojure"><i class="fa fa-tags"></i> clojure (10)</a>

		  
		  
		  
</header>
<div class="article pure-u-22-24">
    <div id="table-of-contents">
<h2>目录</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1 简介</a></li>
<li><a href="#sec-2">2 核心语法</a></li>
<li><a href="#sec-3">3 代码功能</a>
<ul>
<li><a href="#sec-3-1">3.1 读取简繁字典</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-1" class="outline-2">
<h2 id="sec-1">简介</h2>
<div class="outline-text-2" id="text-1">
<p>学习一门语言最好的方法就是去使用它。我们就从一个小例子来学习 Clojure语法.</p>
</div>
</div>
<div id="outline-container-2" class="outline-2">
<h2 id="sec-2"><span class="target">核心语法</span></h2>
<div class="outline-text-2" id="text-2">
<p>首先先来看一下Clojure的核心语法。<br />
Clojure的使用的是Lisp语法,又叫S表达式。核心语法非常的简单。但是对于熟悉c系语法(c,c++,java)的朋友来说，第一次接触会非常的不习惯。</p>
<ul>
<li>所有代码以"("开始,")"结束。即所有的代码都被()包裹
</li>
<li>"("后的第一个数据被当作函数或者宏来调用
</li>
<li>接着的数据被当作参数传递
</li>
<li>如果想原样返回数据，在"("前面添加"'"。此写法是(quote (&hellip;))的简写
</li>
</ul>
<p>以前面的hello world程序为例。</p>
<pre class="src src-clojure"><span style="color: #8c8c8c;">(</span><span style="color: #859900;">println</span> <span style="color: #2aa198;">"Hello World"</span><span style="color: #8c8c8c;">)</span>
</pre>
<p>
它以"("开始，后面跟的是函数println，接着空格跟的是参数"Hello World"，最后")"结尾。了解了如上规则，你就基本学会了Clojure的大部分语法。下面比较一下Clojure,Java,Python,Ruby的一些语法.</p>
<table border="1" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="left" />
<col class="left" />
<col class="left" />
<col class="left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="left">Clojure 表达式</th>
<th scope="col" class="left">对应的 Java 语法</th>
<th scope="col" class="left">对应的 Python 语法</th>
<th scope="col" class="left">对应的 Ruby 语法</th>
</tr>
</thead>
<tbody>
<tr>
<td class="left">(not k)</td>
<td class="left">!k</td>
<td class="left">not k</td>
<td class="left">not k or !k</td>
</tr>
<tr>
<td class="left">(inc a)</td>
<td class="left">a++、++a、a += 1、a + 1<sup>a</sup></td>
<td class="left">a += 1、a + 1</td>
<td class="left">a += 1</td>
</tr>
<tr>
<td class="left">(/ (+ x y) 2)</td>
<td class="left">(x + y) / 2</td>
<td class="left">(x + y) / 2</td>
<td class="left">(x + y) / 2</td>
</tr>
<tr>
<td class="left">(instance? java. util.List al)</td>
<td class="left">al instanceof java.util.List</td>
<td class="left">isinstance(al,list)</td>
<td class="left">al.is<sub>a</sub>? Array</td>
</tr>
<tr>
<td class="left">(if (not a) (inc b) (dec b))</td>
<td class="left">!a ? b + 1 : b - 1</td>
<td class="left">b + 1 if not a else b-1</td>
<td class="left">!a ? b + 1 : b - 1</td>
</tr>
<tr>
<td class="left">(Math/pow 2 10)<sup>c</sup></td>
<td class="left">Math.pow(2, 10)</td>
<td class="left">pow(2, 10)</td>
<td class="left">2 ** 10</td>
</tr>
<tr>
<td class="left">(.someMethod someObj "foo" (.otherMethod otherObj 0))</td>
<td class="left">someObj.someMethod("foo" , otherObj.otherMethod(0))</td>
<td class="left">someObj.someMethod("foo" , otherObj.otherMethod(0))</td>
<td class="left">someObj.someMethod("foo" , otherObj.otherMethod(0))</td>
</tr>
</tbody>
</table>
<p>可以看出Clojure的语法有高度的一致性，即使你不熟悉S表达式，但是依据上面的原则，可以看懂它想表达的是一个什么意思。而对于其他三门语言，如果你没有一个个的学习相应的语法，你还是比较难理解它的意思的。
</p></div>
</div>
<div id="outline-container-3" class="outline-2">
<h2 id="sec-3">代码功能</h2>
<div class="outline-text-2" id="text-3">
<p>了解了核心语法，我们就可以来编写代码了。我们要编写的代码功能很简单，进行简繁翻译，其中过滤不需要翻译的文字。我们将分几步来完成:</p>
<ul>
<li>读取简繁字典
</li>
<li>进行简繁翻译
</li>
<li>读取不需要翻译的文字
</li>
<li>过滤不翻译的文字
</li>
<li>多线程执行
</li>
<li>提供给Java调用
</li>
<li>打包
</li>
</ul>
</div>
<div id="outline-container-3-1" class="outline-3">
<h3 id="sec-3-1">读取简繁字典</h3>
<div class="outline-text-3" id="text-3-1">
<ul>
<li>语法点
<ul>
<li>查看Clojure API
</li>
<li>第一个函数的编写
</li>
<li>Namespace的引入
</li>
<li>正则表达式
</li>
<li>Clojure字面量
</li>
</ul>
</li>
</ul>
<p>
我们先看第一个功能。我们要读取简繁字典。简繁字典其实就是简繁对照的文件，我这里叫jfmap.clj<br />
格式如下:</p>
<pre class="example">万 萬 与 與 丑 醜 专 專 业 業 丛 叢 东 東 丝 絲 丢 丟 两 兩 严 嚴 丧 喪 个 個 丬 爿 
</pre>
<p>
这里只是简单的列了一点。具体内容请见附件。有了这个文件，我们如何把内容读出来呢？熟悉Java的都知道，我们要创建文件流来读取，然后要打开流，循环读取，最后关闭流，还要抓异常。很繁琐。在Clojure中如何处理呢？Clojure提供了slurp函数，可以根据提供的路径将文件内容读入。API如下:</p>
<pre class="src src-clojure">clojure.core/slurp
<span style="color: #8c8c8c;">(</span>[f &amp; opts]<span style="color: #8c8c8c;">)</span>
  <span style="color: #cb4b16;">Opens</span> a reader on f and reads all its contents, returning a string.
  <span style="color: #cb4b16;">See</span> clojure.java.io/reader for a complete list of supported arguments.
</pre>
<p>
OK。我们知道了要用什么函数。那么根据API和上面说的总规则，我们来写代码.</p>
<ul>
<li>首先是"("
</li>
<li>然后是函数名slurp
</li>
<li>空格，参数。这里是要读取的文件路径
</li>
<li>最后")"
</li>
</ul>
<pre class="src src-clojure"><span style="color: #8c8c8c;">(</span><span style="color: #859900;">slurp</span> <span style="color: #2aa198;">"jfmap-path"</span><span style="color: #8c8c8c;">)</span>
</pre>
<p>
你可以在REPL里面去实验这行代码的执行结果。执行此行代码，clojure会将jfmap.clj的内容以字符串的形式全部读入。接着呢？要做简繁翻译，字符串肯定不方便我们的操作。很明显map才是最适合的数据结构。那么我们如何将字符串变成map呢？<br />
我们只能求助于API了，你可以在<a href="http://clojure.github.io/clojure/api-index.html">Clojure的Index页面</a>搜索map,可以找到hash-map函数。它的API说明如下:</p>
<pre class="example">hash-map
function
Usage: (hash-map)
       (hash-map &amp; keyvals)
keyval =&gt; key val
Returns a new hash map with supplied mappings.  If any keys are
equal, they are handled as if by repeated uses of assoc.
</pre>
<p>
根据提供的映射关系返回一个新的hashmap。而这里我们是一个字符串，如何提供映射关系呢？按照空格将文字切开就行了嘛！！继续找API。Java里有split方法，Clojure里有没有相应的函数呢？试试再说。。有了！在clojure.string的Namespace<sup><a class="footref" name="fnr-.1" href="#fn-.1">1</a></sup>中，我们找到了叫split的函数！</p>
<pre class="example">split
function
Usage: (split s re)
       (split s re limit)
Splits string on a regular expression.  Optional argument limit is
the maximum number of splits. Not lazy. Returns vector of the splits.
</pre>
<p>
通过正则表达式来切割字符串。看着挺像，先用再说！我们有repl嘛！直接在repl里面输入</p>
<pre class="src src-clojure"><span style="color: #8c8c8c;">(</span>split <span style="color: #2aa198;">"&#19975; &#33836;"</span> #<span style="color: #2aa198;">" "</span><span style="color: #8c8c8c;">)</span>
</pre>
<p>
执行!Oops,报错了！</p>
<pre class="example">CompilerException java.lang.RuntimeException: Unable to resolve symbol: split in this context
</pre>
<p>
找不到split?!如果在Java中报类似的错误，你会想到什么？没有引入包阿！这里也是。在Java中会默认引入java.lang包，同理在Clojure中会引入clojure.core包。其他包则要自己引入，这里split在clojure.string包中。所以你需要引入clojure.string包。</p>
<pre class="src src-clojure"><span style="color: #8c8c8c;">(</span><span style="color: #859900;">require</span> 'clojure.string<span style="color: #8c8c8c;">)</span>
</pre>
<p>
这也就是调用了require函数来进行引入！为什么clojure.string前面有个单引号呢？想想核心语法！这里暂不展开说！给大家留个思考题！！后续会专门对NameSpace引入做详细介绍！光引入还没用！调用代码也需要修改！</p>
<pre class="src src-clojure"><span style="color: #8c8c8c;">(</span>clojure.string/split <span style="color: #2aa198;">"&#19975; &#33836;"</span> #<span style="color: #2aa198;">" "</span><span style="color: #8c8c8c;">)</span>
</pre>
<p>
你可能要吐槽了！既然引入了，为什么还要加包名前缀？！我们可以和Java作个比较！如果这里是Java的话，那么我们在调用split的时候，实际上是需要一个类作为前缀的，比如StringUtils.split()!但是在clojure中并没有类的概念！包(Clojure叫NameSpace)下面只有函数，所以它使用NameSpace来确保函数的唯一性引用！<br />
当然了每次都要写这么长的NameSpace的名字也是挺烦人的。Clojure提供了简写.</p>
<pre class="src src-clojure"><span style="color: #8c8c8c;">(</span><span style="color: #859900;">require</span> ['clojure.stirng <span style="color: #2aa198;">:as</span> 'cstr]<span style="color: #8c8c8c;">)</span>
<span style="color: #8c8c8c;">(</span>cstr/split <span style="color: #2aa198;">"&#19975; &#33836;"</span> #<span style="color: #2aa198;">" "</span><span style="color: #8c8c8c;">)</span>
</pre>
<p>
:as是Keyword,是Clojure字面量的一种。它和String很类似，不过有些区别，它比String有更多的功能。下表是Clojure所包含的字面量。</p>
<table border="1" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="left" />
<col class="left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="left">Type</th>
<th scope="col" class="left">Example(s)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="left">Boolean</td>
<td class="left">true,false</td>
</tr>
<tr>
<td class="left">Character</td>
<td class="left">\a</td>
</tr>
<tr>
<td class="left">Keyword</td>
<td class="left">:tag,:doc</td>
</tr>
<tr>
<td class="left">List</td>
<td class="left">(1 2 3),(println "foo")</td>
</tr>
<tr>
<td class="left">Map</td>
<td class="left">{:name "Bill",:age 42}</td>
</tr>
<tr>
<td class="left">Nil</td>
<td class="left">nil</td>
</tr>
<tr>
<td class="left">Number</td>
<td class="left">1,4.2</td>
</tr>
<tr>
<td class="left">Set</td>
<td class="left">#{:snap :crackle :pop}</td>
</tr>
<tr>
<td class="left">String</td>
<td class="left">"hello"</td>
</tr>
<tr>
<td class="left">Symbol</td>
<td class="left">user/foo,java.lang.String</td>
</tr>
<tr>
<td class="left">Vector</td>
<td class="left">[1 2 3]</td>
</tr>
</tbody>
</table>
<p>
ok.终于得到了我们要的结果。这里的#" "是正则表达式(这是你遇到的第一个特殊语法，学习方法&mdash;死记！！)，它构建了Java中的Pattern，所以正则表达式内容和Java完全相同，这里就不废话了。你只需要记住其语法就行了。<br />
切开了字符串，我们来生成map吧！如何生成呢？你应该有答案了吧？</p>
<pre class="src src-clojure"><span style="color: #8c8c8c;">(</span><span style="color: #859900;">hash-map</span> <span style="color: #8c8c8c;">(</span>cstr/split <span style="color: #2aa198;">"&#19975; &#33836;"</span> #<span style="color: #2aa198;">" "</span><span style="color: #8c8c8c;">))</span>
</pre>
<p>
又报错了！</p>
<pre class="example">IllegalArgumentException No value supplied for key: ["万" "萬"]  clojure.lang.PersistentHashMap.create (PersistentHashMap.java:77)
</pre>
<p>
不合法的参数！！split得到的是个Vector([]包裹的数据结构是Vector),而hash-map要的参数类似于Java中的可变参数！如何匹配这两者呢？Clojure中提供了apply函数!API如下</p>
<pre class="src src-clojure">clojure.core/apply
<span style="color: #8c8c8c;">(</span>[f args] [f x args] [f x y args] [f x y z args] [f a b c d &amp; args]<span style="color: #8c8c8c;">)</span>
  <span style="color: #cb4b16;">Applies</span> fn f to the argument list formed by prepending intervening arguments to args.
</pre>
<p>
此函数有点特别！它的第一个参数是函数，后面是该函数所需要的参数！知道怎么调用吗？</p>
<pre class="src src-clojure"><span style="color: #8c8c8c;">(</span><span style="color: #859900;">apply</span> hash-map <span style="color: #8c8c8c;">(</span>cstr/split <span style="color: #2aa198;">"&#19975; &#33836;"</span> #<span style="color: #2aa198;">" "</span><span style="color: #8c8c8c;">))</span>
</pre>
<p>
终于成功了！！我们看到了结果</p>
<pre class="src src-clojure">{<span style="color: #2aa198;">"&#19975;"</span> <span style="color: #2aa198;">"&#33836;"</span>}   <span style="color: #93a1a1; font-style: italic;">;</span><span style="color: #93a1a1; font-style: italic;">&#20197;{}&#21253;&#35065;&#30340;&#25968;&#25454;&#32467;&#26500;&#26159;map</span>
</pre>
<p>
最后呢！我们需要对jfmap.clj的内容进行处理！So easy!</p>
<pre class="src src-clojure"><span style="color: #8c8c8c;">(</span><span style="color: #859900;">apply</span> hash-map <span style="color: #8c8c8c;">(</span>cstr/split <span style="color: #8c8c8c;">(</span><span style="color: #859900;">slurp</span> <span style="color: #2aa198;">"jfmap-path"</span><span style="color: #8c8c8c;">)</span> #<span style="color: #2aa198;">" "</span><span style="color: #8c8c8c;">))</span>
</pre>
<div id="footnotes">
<h2 class="footnotes">脚注: </h2>
<div id="text-footnotes">
<p class="footnote"><sup><a class="footnum" name="fn-.1" href="#fnr-.1">1</a></sup> Namespace和Java中的包类似，但是在Clojure中叫Namespace。这里没有将其翻<br />
译为命名空间，主要是怕有误解。</p>
</div>
</div>
</div>
</div>
</div>

</div>

    <div class="pure-g pagination">
        
        <a class="pure-u-1-2 pagination-item " href="/luminus/useful-libraries.html" title="Luminus手册-Useful Libraries "><p> <i class="fa fa-mail-reply"></i>&nbsp;Luminus手册-Useful Libraries</p></a>
        
        
        <a class="pure-u-1-2 pagination-item " href="/clojure/clojure%25e6%2595%2599%25e7%25a8%258b-%25e5%259f%25ba%25e6%259c%25ac%25e8%25af%25ad%25e6%25b3%2595.html" title="Clojure教程-基本语法"><p>Clojure教程-基本语法&nbsp;<i class="fa fa-mail-forward"></i></p></a>
        
    </div>
    <link href="/css/code.css" rel="stylesheet">
    <link href="/css/min/fancybox.css" rel="stylesheet">
    <script src="/js/min/jquery.toc.min.js" ></script>
    <script src="/js/min/jquery.qrcode.min.js" ></script>
    <script src="/js/min/jquery.fancybox.pack.js" ></script>
    <script src="/js/page.js" ></script>

    
    

    
    
    <a name="comments"> </a>
<div id="comment">
    <div class="ds-thread" data-title="Clojure教程-基本语法-01"></div>
    <script type="text/javascript">
        var duoshuoQuery = {short_name:""};
        (function() {
            var ds = document.createElement('script');
            ds.type = 'text/javascript';ds.async = true;
            ds.src = '../js/min/duoshuo.js';
            ds.charset = 'UTF-8';
            (document.getElementsByTagName('head')[0]
                    || document.getElementsByTagName('body')[0]).appendChild(ds);
        })();
    </script>
</div>

    






            </div>
            </div>
        <div class="footer">
                <a href="/love/welcome-my-blog.html">About</a>
                 <a href="/1">Collecting</a>
                <a href="tencent://message/?uin=561802774">QQ</a>
                <a href="https://github.com/ivanpig">GitHub</a>
            <script src="/js/min/nprogress.min.js"></script>
            <script src="/js/index.js"></script>
        </div>
        <div class="topfade"><a href="javascript:;" title="返回顶部"></a></div>

    </div>

</div>

</body>

</html>
