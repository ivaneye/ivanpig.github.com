<!DOCTYPE HTML>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="description" content="">
        <meta name="keywords" content=""/>
        <meta name="author" content="ivanpig.github.io"> 
        <link rel="canonical" href="http://www.ivaneye.com/page/8/index.html">
        <link href="http://www.ivaneye.com/rss.xml" title="RSS 2.0" type="application/rss+xml" rel="alternate"/>
        <link href="/img/favicon.ico" rel="icon" type="image/x-icon">
        <title>不懂管理的开发不是好架构</title>
        <link rel="stylesheet" href="/css/min/pure-min.css">
        <!--[if lte IE 8]>
<link rel="stylesheet" href="/css/min/grids-responsive-old-ie-min.css">
<![endif]-->
        <!--[if gt IE 8]><!-->
        <link rel="stylesheet" href="/css/min/grids-responsive-min.css">
        <!--<![endif]-->

        <!--[if lte IE 8]>
<link rel="stylesheet" href="/css/JekyllPure-old-ie.css">
<![endif]-->
        <!--[if gt IE 8]><!-->
        <link rel="stylesheet" href="/css/JekyllPure.css">
        <!--<![endif]-->

        <link href="/css/min/font-awesome.min.css" rel="stylesheet">
        <!--[if lte IE 8]>
<link rel="stylesheet" href="/css/min/font-awesome-ie7.min.css">
<![endif]-->
        <script src="/js/min/jquery-1.7.2.min.js"></script>
        <link rel="stylesheet" href="/css/themes/my.css"/>
        <script src="/js/highlight.pack.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>
    </head>

    <body>

        <div id="layout" class="pure-g">
            <div class="sidebar pure-u-1 pure-u-md-1-4">
                <div class="header">
                    <div class="headerpic">
                        <a href="/">
                            <img src="/img/head.jpg" alt="Profile Picture" style="width: 140px;" title="返回首页">
                        </a>
                    </div>
                    <!-- <h1 class="brand-title">IvanPig's Blog</h1>-->
                    <h2 id="_tagline" class="brand-tagline">Just Perfect</h2>
<!--                     <br class="newline"/><br class="newline"/> -->

                    <nav class="nav">
                        <ul class="nav-list">
                            <li class="nav-item">
                                <a class="pure-button" href="/Timing">时间轴</a>
                            </li>
                            <li class="nav-item">
                                <a class="pure-button" href="/tag">标签库</a>
                            </li>
                            <li class="nav-item">
                                <a class="pure-button" href="/type">分类库</a>
                            </li>
                        </ul>
                    </nav>
                    <div class="search">
                        <form action="/search">
                            <input type="text" class="search-query" placeholder="Search Blog" name="query" title="全站搜索-只支持英文">
                        </form>
                    </div>

                    <div id="toc"></div>
                    <div id="toc1"></div>
                    <nav id="nav">
                        <ul class="nav-list">
                            <li class="nav-link">
                                <a class="weibo "  href="http://weibo.com/1686537657/profile?topnav=1&wvr=6" ><i class="fa fa-weibo fa-2x"></i></a>
                            </li>
                            <li class="nav-link">
                                <a class="github" href="https://github.com/ivanpig"><i class="fa fa-github fa-2x"></i></a>
                            </li>
                            <li class="nav-link">
                                <a class="rss" href="/rss.xml" ><i class="fa fa-rss fa-2x"></i></a>
                            </li>
                        </ul>
                    </nav>
							<div id="qrcode">
							<img src="/img/qrcode.jpg" width="170"/>
							</div>
                </div>
            </div>

            <div class="content pure-u-1 pure-u-md-3-4">
                <!--[if lt IE 8]>
<i class="label label-danger">亲爱的用户，您的浏览器版本过低，建议您升级浏览器获得更好的用户体验</i>
<![endif]-->
                <div>
                    <div class="posts">

                        




























<section class="post">
    <header class="post-header">
        
        <img class="post-avatar" height="48" width="48"
             src="/img/head.jpg">
        

        <h2 class="post-title"><a href="/2014/02/02/basic.html">Clojure教程-基本语法</a></h2>

        <p class="post-meta">By 02月02日  2014
            
            
            
            
            <a class="post-categorybut " href="/type/#clojure"><i class="fa fa-folder-open">clojure (10)</i></a>
            
            
            

            
            
            
            
            <a class="post-category " href="/tag/#"><i class="fa fa-tags">clojure (55)</i></a>
            
            
        
        

    </p>
</header>

<div class="post-description">
    <h1>简介</h1>

<p>学习一门语言最好的方法就是去使用它。我们就从一个小例子来学习Clojure语法.</p>

<h1>核心语法</h1>

<p>首先先来看一下Clojure的核心语法。</p>

<p>Clojure的使用的是Lisp语法,又叫S表达式。核心语法非常的简单。但是对于熟悉c系语法(c,c++,java)的朋友来说，第一次接触会非常的不习惯。</p>

<ul>
<li>所有代码以"("开始,")"结束。即所有的代码都被()包裹</li>
<li>"("后的第一个数据被当作函数或者宏来调用</li>
<li>接着的数据被当作参数传递</li>
<li>如果想原样返回数据，在"("前面添加"'"。此写法是(quote (...))的简写</li>
</ul>


<p>以前面的hello world程序为例。</p>

<pre><code class="{.clojure}">(println "Hello World")
</code></pre>

<p>它以"("开始，后面跟的是函数println，接着空格跟的是参数"HelloWorld"，最后")"结尾。</p>

<p>了解了如上规则，你就基本学会了Clojure的大部分语法。</p>

<p>下面比较一下Clojure,Java,Python,Ruby的一些语法.</p>

<table>
<thead>
<tr>
<th style="text-align:left;"> Clojure 表达式</th>
<th style="text-align:left;"> 对应的 Java 语法   </th>
<th style="text-align:left;"> 对应的 Python 语法 </th>
<th style="text-align:left;">对应的 Ruby 语法</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;"> (not k)                        </td>
<td style="text-align:left;"> !k                           </td>
<td style="text-align:left;"> not k                   </td>
<td style="text-align:left;"> not k or !k                                       </td>
</tr>
<tr>
<td style="text-align:left;"> (inc a)                        </td>
<td style="text-align:left;"> a++、++a、a += 1、a + 1<sup>a</sup>    </td>
<td style="text-align:left;"> a += 1、a + 1           </td>
<td style="text-align:left;"> a += 1                                              </td>
</tr>
<tr>
<td style="text-align:left;"> (/ (+ x y) 2)                  </td>
<td style="text-align:left;"> (x + y) / 2                  </td>
<td style="text-align:left;"> (x + y) / 2             </td>
<td style="text-align:left;"> (x + y) / 2                                       </td>
</tr>
<tr>
<td style="text-align:left;"> (instance? java. util.List al) </td>
<td style="text-align:left;"> al instanceof java.util.List </td>
<td style="text-align:left;"> isinstance(al,list)     </td>
<td style="text-align:left;"> al.is_a? Array                                    </td>
</tr>
<tr>
<td style="text-align:left;"> (if (not a) (inc b) (dec b))   </td>
<td style="text-align:left;"> !a ? b + 1 : b - 1           </td>
<td style="text-align:left;"> b + 1 if not a else b-1 </td>
<td style="text-align:left;"> !a ? b + 1 : b - 1                                </td>
</tr>
<tr>
<td style="text-align:left;"> (Math/pow 2 10)<sup>c</sup>              </td>
<td style="text-align:left;"> Math.pow(2, 10)              </td>
<td style="text-align:left;"> pow(2, 10)              </td>
<td style="text-align:left;"> 2 ** 10                                           </td>
</tr>
<tr>
<td style="text-align:left;"> (.someMethod someObj "foo" (.otherMethod otherObj 0)) </td>
<td style="text-align:left;">someObj.someMethod("foo" , otherObj.otherMethod(0)) </td>
<td style="text-align:left;">someObj.someMethod("foo" , otherObj.otherMethod(0)) </td>
<td style="text-align:left;">someObj.someMethod("foo" , otherObj.otherMethod(0)) </td>
</tr>
</tbody>
</table>


<p>可以看出Clojure的语法有高度的一致性，即使你不熟悉S表达式，但是依据上面的原则，可以看懂它想表达的是一个什么意思。</p>

<p>而对于其他三门语言，如果你没有一个个的学习相应的语法，你还是比较难理解它的意思的。</p>

<h1>代码功能</h1>

<p>了解了核心语法，我们就可以来编写代码了。我们要编写的代码功能很简单，进行简繁翻译，其中过滤不需要翻译以及需要特殊翻译的文字。我们将分几步来完成:</p>

<ul>
<li>读取简繁字典</li>
<li>进行简繁翻译</li>
<li>读取不需要翻译的文字</li>
<li>过滤不翻译的文字</li>
<li>提供给Java调用</li>
<li>打包</li>
</ul>





    <a href="/2014/02/02/basic.html" class="post-categorybut">阅读全文</a>
</div>
</section>






<section class="post">
    <header class="post-header">
        
        <img class="post-avatar" height="48" width="48"
             src="/img/head.jpg">
        

        <h2 class="post-title"><a href="/2014/02/01/first_step.html">Clojure教程-环境搭建与Hello World</a></h2>

        <p class="post-meta">By 02月01日  2014
            
            
            
            
            <a class="post-categorybut " href="/type/#clojure"><i class="fa fa-folder-open">clojure (10)</i></a>
            
            
            

            
            
            
            
            <a class="post-category " href="/tag/#"><i class="fa fa-tags">clojure (55)</i></a>
            
            
        
        

    </p>
</header>

<div class="post-description">
    <h1>环境搭建</h1>

<p>Clojure是JVM上的一种语言，其语法是Lisp格式，所以称为是JVM上的Lisp方言。</p>

<p>Clojure依赖于JDK。请确保你的机器上安装了JDK6+。Clojure的安装非常的简单。
可以分为两种方式:</p>

<ul>
<li>通过Leiningen安装</li>
<li>手动安装</li>
</ul>


<p>通过Leiningen是比较普遍也很方便的方式。我们先通过Leiningen来安装。</p>

<h2>通过Leiningen安装</h2>

<p>Leiningen和Maven比较类似，是Clojure语言的管理工具。其实它就是基于Maven
构建的。我们先来安装Leiningen</p>

<ul>
<li>首先下载<a href="https://raw.github.com/technomancy/leiningen/stable/bin/lein">lein
script</a></li>
<li>将lein script放置到你的path下(linux下直接放到用户目录下即可)，保存文
件名叫lein。</li>
<li>将其权限设置为可执行(chmod a+x lein)</li>
<li>打开shell，输入lein即可</li>
</ul>


<p>leiningen会自动下载需要的依赖。运行完成后,Clojure开发环境即安装完成。</p>

<h2>手动安装</h2>

<p>leiningen需要以项目为单位才能运行。比如你想运行一个hello.clj程序，如果
你通过leiningen来运行，则hello.clj需要在lein项目内，且设置为core，才能
运行,比较麻烦(这个问题在Maven中同样存在)。</p>

<p>而通过手动安装可以解决这个问题。</p>

<ul>
<li>首先下载<a href="http://repo1.maven.org/maven2/org/clojure/clojure/1.5.1/clojure-1.5.1.zip">Clojure</a>,
目前稳定版本是1.5.1</li>
<li>解压到任意位置，其中最主要的文件就是clojure-1.5.1.jar</li>
<li>在path下编写脚本clj,输入如下内容</li>
</ul>


<pre><code class="{.bash}">java -jar /home/ivan/soft/clojure-1.5.1/clojure-1.5.1.jar $1
 #clojure.jar请输入你本机的路径
</code></pre>

<p>这样就可以执行单个的Clojure文件了</p>




    <a href="/2014/02/01/first_step.html" class="post-categorybut">阅读全文</a>
</div>
</section>






<section class="post">
    <header class="post-header">
        
        <img class="post-avatar" height="48" width="48"
             src="/img/head.jpg">
        

        <h2 class="post-title"><a href="/2013/10/02/upgrading.html">Luminus手册-升级</a></h2>

        <p class="post-meta">By 10月02日  2013
            
            
            
            
            <a class="post-categorybut " href="/type/#luminus"><i class="fa fa-folder-open">luminus (19)</i></a>
            
            
            

            
            
            
            
            <a class="post-category " href="/tag/#"><i class="fa fa-tags">clojure (55)</i></a>
            
            <a class="post-category " href="/tag/#"><i class="fa fa-tags">luminus (19)</i></a>
            
            
        
        

    </p>
</header>

<div class="post-description">
    <h1>Upgrading to the Latest Version</h1>

<p>不幸的是，框架无法自动从老版本升级到新版本。主要原因是新版本的依赖可能会有接口方面的修改，导致老代码无法正常运行。</p>

<p>最好的方法是使用<a href="https://github.com/xsc/lein-ancient">lein-ancient</a>插件来保持你的依赖包时刻为最新。这将会帮你很容易的发现哪些插件有了新的版本。</p>



    <a href="/2013/10/02/upgrading.html" class="post-categorybut">阅读全文</a>
</div>
</section>






<section class="post">
    <header class="post-header">
        
        <img class="post-avatar" height="48" width="48"
             src="/img/head.jpg">
        

        <h2 class="post-title"><a href="/2013/10/01/useful_libraries.html">Luminus手册-实用库</a></h2>

        <p class="post-meta">By 10月01日  2013
            
            
            
            
            <a class="post-categorybut " href="/type/#luminus"><i class="fa fa-folder-open">luminus (19)</i></a>
            
            
            

            
            
            
            
            <a class="post-category " href="/tag/#"><i class="fa fa-tags">clojure (55)</i></a>
            
            <a class="post-category " href="/tag/#"><i class="fa fa-tags">luminus (19)</i></a>
            
            
        
        

    </p>
</header>

<div class="post-description">
    <p>Luminus的目标是从细粒度来方便你开发web应用。所以它默认包含了很多库包。</p>

<p>包括lib-noir提供一般工具，Selmer/Hiccup提供HTML模板,Timbre提供日志功能，
Tower提供国际化等等其他包。</p>

<p>当然，还有很多的包能给web开发带来便利。</p>

<p>具体请见<a href="http://www.luminusweb.net/docs/useful_libraries.md">此处</a></p>



    <a href="/2013/10/01/useful_libraries.html" class="post-categorybut">阅读全文</a>
</div>
</section>






<section class="post">
    <header class="post-header">
        
        <img class="post-avatar" height="48" width="48"
             src="/img/head.jpg">
        

        <h2 class="post-title"><a href="/2013/09/30/deployment.html">Luminus手册-部署</a></h2>

        <p class="post-meta">By 09月30日  2013
            
            
            
            
            <a class="post-categorybut " href="/type/#luminus"><i class="fa fa-folder-open">luminus (19)</i></a>
            
            
            

            
            
            
            
            <a class="post-category " href="/tag/#"><i class="fa fa-tags">clojure (55)</i></a>
            
            <a class="post-category " href="/tag/#"><i class="fa fa-tags">luminus (19)</i></a>
            
            
        
        

    </p>
</header>

<div class="post-description">
    <h1>Running Standalone</h1>

<p>要创建一个可独立运行的包，只需要运行如下的命令:</p>

<pre><code class="{.bash}">lein ring uberjar
</code></pre>

<p>打包完成的jar会出现在target目录下。可以通过下面的命令运行:</p>

<pre><code class="{.clojure}">java -jar myapp-0.1.0-SNAPSHOT-standalone.jar
</code></pre>

<p>独立可运行的程序可以使用Jetty来运行。如果要设置端口号，你需要设置\$PORT
环境变量:</p>

<pre><code class="{.bash}">export PORT=8080
java -jar target/myapp1-0.1.0-SNAPSHOT-standalone.jar
</code></pre>

<h1>Delpoying on Immutant</h1>

<p>如果想部署应用到Immutant，请执行如下命令:</p>

<pre><code class="{.bash}">lein immutant deploy
</code></pre>

<p>更多信息请访问<a href="http://immutant.org/tutorials/deploying/index.html">官网</a></p>

<h1>Deploying to Tomcat</h1>

<p>如果想打包应用为war包:</p>

<pre><code class="{.bash}">lein ring uberwar
</code></pre>

<p>然后只需要将打好的包拷贝到tomcat的webapps目录下即可:</p>

<pre><code class="{.bash}">cp target/myapp-0.1.0-SNAPSHOT-standalone.war ~/tomcat/webapps/myapp.war
</code></pre>




    <a href="/2013/09/30/deployment.html" class="post-categorybut">阅读全文</a>
</div>
</section>






<section class="post">
    <header class="post-header">
        
        <img class="post-avatar" height="48" width="48"
             src="/img/head.jpg">
        

        <h2 class="post-title"><a href="/2013/09/29/internationalization.html">Luminus手册-国际化</a></h2>

        <p class="post-meta">By 09月29日  2013
            
            
            
            
            <a class="post-categorybut " href="/type/#luminus"><i class="fa fa-folder-open">luminus (19)</i></a>
            
            
            

            
            
            
            
            <a class="post-category " href="/tag/#"><i class="fa fa-tags">clojure (55)</i></a>
            
            <a class="post-category " href="/tag/#"><i class="fa fa-tags">luminus (19)</i></a>
            
            
        
        

    </p>
</header>

<div class="post-description">
    <h1>Internationalization</h1>

<p>Luminius模板包含了<a href="https://github.com/ptaoussanis/tower">Tower</a>依赖，Tower提供了函数式的国际化和翻译。</p>

<p>首先，我们需要创建一个字典map：</p>

<pre><code class="clojure">(def tconfig
  {:fallback-locale :en-US
   :dictionary
   {:en-US   {:page {:title "Here is a title"
                     :content "Time to start building your site."}
              :missing  "&lt;Missing translation: [%1$s %2$s %3$s]&gt;"}
    :fr-FR {:page {:title "Voici un titre"
                   :content "Il est temps de commencer votre site."}}
    }})
</code></pre>

<p>然后添加Tower中间件来包装我们的配置:</p>

<pre><code>(def app
 (app-handler
   [routes]
   :middleware
   [#(taoensso.tower.ring/wrap-tower-middleware % {:tconfig tconfig})]))
</code></pre>

<p>中间件将会通过accept-language头来确定相应的语言。中间件将会添加两个key到请求中。地一个key是:t,它的值是翻译函数。第二个key是:locale，它的值是中间件提供的语言类型。</p>

<p>你可以提供一个自定义的locale-selector函数给中间件。</p>

<pre><code class="clojure">(defn my-selector [req]
  (when (= (:remote-addr req) "127.0.0.1") :en))

(def app
  (app-handler
    [routes]
    :middleware
    [#(wrap-tower-middleware % {:tconfig tconfig
                                :locale-selector my-selector})]))
</code></pre>




    <a href="/2013/09/29/internationalization.html" class="post-categorybut">阅读全文</a>
</div>
</section>






<section class="post">
    <header class="post-header">
        
        <img class="post-avatar" height="48" width="48"
             src="/img/head.jpg">
        

        <h2 class="post-title"><a href="/2013/09/28/logging.html">Luminus手册-日志</a></h2>

        <p class="post-meta">By 09月28日  2013
            
            
            
            
            <a class="post-categorybut " href="/type/#luminus"><i class="fa fa-folder-open">luminus (19)</i></a>
            
            
            

            
            
            
            
            <a class="post-category " href="/tag/#"><i class="fa fa-tags">clojure (55)</i></a>
            
            <a class="post-category " href="/tag/#"><i class="fa fa-tags">luminus (19)</i></a>
            
            
        
        

    </p>
</header>

<div class="post-description">
    <h1>Logging</h1>

<p>Luminus模板中包括<a href="https://github.com/ptaoussanis/timbre">Timbre</a>和<a href="https://bitbucket.org/postspectacular/rotor">Rotor</a>。</p>

<p>日志通过在handler/init函数中进行如下的设置进行初始化:</p>

<pre><code class="{.clojure}">  (timbre/set-config!
    [:appenders :rotor]
    {:min-level :info
     :enabled? true
     :async? false ; should be always false for rotor
     :max-message-per-msecs nil
     :fn rotor/append})

  (timbre/set-config!
    [:shared-appender-config :rotor]
    {:path ".log" :max-size 10000 :backlog 10})
</code></pre>

<p>Timbre可以记录Clojure的所有日志.</p>

<pre><code class="{.clojure}">(ns example
 (:use [taoensso.timbre :only [trace debug info warn error fatal]]))

(info "Hello")

=&gt;2012-Dec-24 09:03:09 -0500 Helios.local INFO [timbretest] - Hello

(info {:user {:id "Anonymous"}})

=&gt;2012-Dec-24 09:02:44 -0500 Helios.local INFO [timbretest] - {:user {:id "Anonymous"}}
</code></pre>

<p>更多信息请见<a href="https://github.com/ptaoussanis/timbre">Github</a></p>



    <a href="/2013/09/28/logging.html" class="post-categorybut">阅读全文</a>
</div>
</section>


<div class="pure-g pagination">
    
    
    <a class=" pure-u-1-2 pagination-item" href="/page/7"><p>← Newer</p></a>
    
    


    
    <a class=" pure-u-1-2 pagination-item" href="/page/9"><p>Older →</p></a>
    
</div>








                    </div>
                </div>
                <div class="footer">
                    <a href="/about.html">About</a>
                    <a href="tencent://message/?uin=561802774">QQ</a>
                    <a href="https://github.com/ivanpig">GitHub</a>
                    <script src="/js/min/nprogress.min.js"></script>
                    <script src="/js/index.js"></script>
                </div>
                <div class="topfade"><a href="javascript:;" title="返回顶部"></a></div>

            </div>

        </div>
<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F2278992c92bf7ea162797e107e900616' type='text/javascript'%3E%3C/script%3E"));
</script>

    </body>

</html>
