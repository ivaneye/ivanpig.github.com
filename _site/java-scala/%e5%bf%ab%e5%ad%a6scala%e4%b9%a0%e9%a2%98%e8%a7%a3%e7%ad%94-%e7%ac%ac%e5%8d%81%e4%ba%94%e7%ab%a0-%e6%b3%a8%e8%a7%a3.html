<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="keywords" content="java, scala"/>
    <meta name="author" content="liyouhai.com"> 
    <link rel="canonical" href="http://liyouhai.com/java-scala/%25e5%25bf%25ab%25e5%25ad%25a6scala%25e4%25b9%25a0%25e9%25a2%2598%25e8%25a7%25a3%25e7%25ad%2594-%25e7%25ac%25ac%25e5%258d%2581%25e4%25ba%2594%25e7%25ab%25a0-%25e6%25b3%25a8%25e8%25a7%25a3.html">
    <link href="http://liyouhai.com/rss.xml" title="RSS 2.0" type="application/rss+xml" rel="alternate"/>
    <link href="/img/favicon.ico" rel="icon" type="image/x-icon">
    <title>快学Scala习题解答—第十五章 注解 - IvanPig's Blog</title>
    <link rel="stylesheet" href="/css/min/pure-min.css">
    <!--[if lte IE 8]>
    <link rel="stylesheet" href="/css/min/grids-responsive-old-ie-min.css">
    <![endif]-->
    <!--[if gt IE 8]><!-->
    <link rel="stylesheet" href="/css/min/grids-responsive-min.css">
    <!--<![endif]-->

    <!--[if lte IE 8]>
    <link rel="stylesheet" href="/css/JekyllPure-old-ie.css">
    <![endif]-->
    <!--[if gt IE 8]><!-->
    <link rel="stylesheet" href="/css/JekyllPure.css">
    <!--<![endif]-->

    <link href="/css/min/font-awesome.min.css" rel="stylesheet">
    <!--[if lte IE 8]>
    <link rel="stylesheet" href="/css/min/font-awesome-ie7.min.css">
    <![endif]-->
    <script src="/js/min/jquery-1.7.2.min.js"></script>
    <!--
     /\_ \    __                         /\ \                __
     \//\ \  /\_\  __  __    ___   __  __\ \ \___      __   /\_\
       \ \ \ \/\ \/\ \/\ \  / __`\/\ \/\ \\ \  _ `\  /'__`\ \/\ \
        \_\ \_\ \ \ \ \_\ \/\ \L\ \ \ \_\ \\ \ \ \ \/\ \L\.\_\ \ \
        /\____\\ \_\/`____ \ \____/\ \____/ \ \_\ \_\ \__/.\_\\ \_\
        \/____/ \/_/`/___/> \/___/  \/___/   \/_/\/_/\/__/\/_/ \/_/
                       /\___/
                       \/__/
     图像可以到http://asciigen.com/  生成..记得翻墙才能正常生成.如不方便可以博客留言我帮你生成
     -->
</head>

<body>







<div id="layout" class="pure-g">
    <div class="sidebar pure-u-1 pure-u-md-1-4">
        <div class="header">
            <div class="headerpic">
                <a href="/">
                    <img src="/img/op.jpg" alt="Profile Picture" style="width: 140px;" title="返回首页">
                </a>
            </div>
            <!-- <h1 class="brand-title">IvanPig's Blog</h1>-->
            <h2 class="brand-tagline">IvanPig's Blog</h2>

            <nav class="nav">
                <ul class="nav-list">
                    <li class="nav-item">
                        <a class="pure-button" href="/Timing">时间轴</a>
                    </li>
                    <li class="nav-item">
                        <a class="pure-button" href="/tag">标签库</a>
                    </li>
                    <!--<li class="nav-item">
                        <a class="pure-button" href="/1">收藏站</a>
                    </li>
                    <li class="nav-item">
                        <a class="pure-button" href="/1">音乐屋</a>-->

                </ul>
            </nav>
            <div class="search">
                <form action="/search">
                    <input type="text" class="search-query" placeholder="Search Blog" name="query" title="全站搜索-只支持英文">
                </form>
            </div>
            <div id="toc"></div>
            <nav id="nav">
                <ul class="nav-list">
                    <li class="nav-link">
                    <a class="weibo "  href="http://weibo.com/1686537657/profile?topnav=1&wvr=6" ><i class="fa fa-weibo fa-2x"></i></a>
                    </li>
                    <li class="nav-link">
                    <a class="github" href="https://github.com/ivanpig"><i class="fa fa-github fa-2x"></i></a>
                    </li>
                    <li class="nav-link">
                    <a class="rss" href="/rss.xml" ><i class="fa fa-rss fa-2x"></i></a>
                    </li>
                </ul>
            </nav>
        </div>
    </div>

    <div class="content pure-u-1 pure-u-md-3-4">
        <!--[if lt IE 8]>
        <i class="label label-danger">亲爱的用户，您的浏览器版本过低，建议您升级浏览器获得更好的用户体验</i>
        <![endif]-->
        <div>
            <div class="posts">

                <div class="qrcodeTable"></div>
<header class="post-header">
    <img class="post-avatar" height="48" width="48"
         src="">

    <h2 class="post-title">快学Scala习题解答—第十五章 注解</h2>

    <p class="post-meta">By 03月18日  2013  



 
<a class="post-categorybut " href="/type/#"><i class="fa fa-folder-open"></i> java-scala (20)</a>


  



		  
			 
<a class="post-category " href="/tag/#java"><i class="fa fa-tags"></i> java (16)</a>
 
<a class="post-category " href="/tag/#java"><i class="fa fa-tags"></i> scala (19)</a>

		  
		  
		  
</header>
<div class="article pure-u-22-24">
    <h2 id="sec-16" style="margin: 5px; color: rgb(101, 122, 131); font-family: MONACO, 'trebuchet ms', arial, helvetica, sans-serif; line-height: normal; background-color: rgb(253, 246, 227);">
	<span class="section-number-2">16</span>&nbsp;注解<br />
</h2>
<div class="outline-text-2" id="text-16" style="color: rgb(101, 122, 131); font-family: MONACO, 'trebuchet ms', arial, helvetica, sans-serif; font-size: 13px; line-height: normal; background-color: rgb(253, 246, 227);">
	&nbsp;
</div>
<div class="outline-3" id="outline-container-16-1" style="color: rgb(101, 122, 131); font-family: MONACO, 'trebuchet ms', arial, helvetica, sans-serif; font-size: 13px; line-height: normal; background-color: rgb(253, 246, 227);">
<h3 id="sec-16-1" style="margin: 5px 10px;">
		<span class="section-number-3">16.1</span>&nbsp;编写四个JUnit测试用例，分别使用带或不带某个参数的@Test注解。用JUnit执行这些测试<br />
	</h3>
<div class="outline-text-3" id="text-16-1">
<pre class="src src-scala" style="border: 1pt solid rgb(174, 189, 204); background-color: rgb(243, 245, 247); padding: 5pt; font-family: courier, monospace; font-size: small; overflow: auto; margin: 5px 10px;">
<span style="color: rgb(133, 153, 0);">import</span> org.junit.Test

<span style="color: rgb(133, 153, 0);">class</span> <span style="color: rgb(181, 137, 0);">ScalaTest</span> {

  @Test
  <span style="color: rgb(133, 153, 0);">def</span> <span style="color: rgb(38, 139, 210);">test1</span>(){
    print(<span style="color: rgb(42, 161, 152);">&quot;test1&quot;</span>)
  }

  @Test(timeout = 1L)
  <span style="color: rgb(133, 153, 0);">def</span> <span style="color: rgb(38, 139, 210);">test2</span>(){
    print(<span style="color: rgb(42, 161, 152);">&quot;test2&quot;</span>)
  }
}
</pre>
</p></div>
</div>
<div class="outline-3" id="outline-container-16-2" style="color: rgb(101, 122, 131); font-family: MONACO, 'trebuchet ms', arial, helvetica, sans-serif; font-size: 13px; line-height: normal; background-color: rgb(253, 246, 227);">
<h3 id="sec-16-2" style="margin: 5px 10px;">
		<span class="section-number-3">16.2</span>&nbsp;创建一个类的示例，展示注解可以出现的所有位置。用@deprecated作为你的示例注解。<br />
	</h3>
<div class="outline-text-3" id="text-16-2">
<pre class="src src-scala" style="border: 1pt solid rgb(174, 189, 204); background-color: rgb(243, 245, 247); padding: 5pt; font-family: courier, monospace; font-size: small; overflow: auto; margin: 5px 10px;">
@deprecated
<span style="color: rgb(133, 153, 0);">class</span> <span style="color: rgb(181, 137, 0);">Test</span>{

  @deprecated
  <span style="color: rgb(133, 153, 0);">val</span> <span style="color: rgb(38, 139, 210);">t</span> = _;

  @deprecated(message = <span style="color: rgb(42, 161, 152);">&quot;unuse&quot;</span>)
  <span style="color: rgb(133, 153, 0);">def</span> <span style="color: rgb(38, 139, 210);">hello</span>(){
    println(<span style="color: rgb(42, 161, 152);">&quot;hello&quot;</span>)
  }
}

@deprecated
<span style="color: rgb(133, 153, 0);">object</span> <span style="color: rgb(38, 139, 210);">Test</span> <span style="color: rgb(133, 153, 0);">extends</span> <span style="color: rgb(181, 137, 0);">App</span>{
  <span style="color: rgb(133, 153, 0);">val</span> <span style="color: rgb(38, 139, 210);">t</span> = <span style="color: rgb(133, 153, 0);">new</span> Test()
  t.hello()
  t.t
}
</pre>
</p></div>
</div>
<div class="outline-3" id="outline-container-16-3" style="color: rgb(101, 122, 131); font-family: MONACO, 'trebuchet ms', arial, helvetica, sans-serif; font-size: 13px; line-height: normal; background-color: rgb(253, 246, 227);">
<h3 id="sec-16-3" style="margin: 5px 10px;">
		<span class="section-number-3">16.3</span>&nbsp;Scala类库中的哪些注解用到了元注解@param,@field,@getter,@setter,@beanGetter或@beanSetter?<br />
	</h3>
<div class="outline-text-3" id="text-16-3">
<p style="margin: 5px 10px; text-indent: 40px;">
			看Scala注解的源码就OK了
		</p>
</p></div>
</div>
<div class="outline-3" id="outline-container-16-4" style="color: rgb(101, 122, 131); font-family: MONACO, 'trebuchet ms', arial, helvetica, sans-serif; font-size: 13px; line-height: normal; background-color: rgb(253, 246, 227);">
<h3 id="sec-16-4" style="margin: 5px 10px;">
		<span class="section-number-3">16.4</span>&nbsp;编写一个Scala方法sum,带有可变长度的整型参数，返回所有参数之和。从Java调用该方法。<br />
	</h3>
<div class="outline-text-3" id="text-16-4">
<pre class="src src-scala" style="border: 1pt solid rgb(174, 189, 204); background-color: rgb(243, 245, 247); padding: 5pt; font-family: courier, monospace; font-size: small; overflow: auto; margin: 5px 10px;">
<span style="color: rgb(133, 153, 0);">import</span> annotation.varargs

<span style="color: rgb(133, 153, 0);">class</span> <span style="color: rgb(181, 137, 0);">Test</span>{

  @varargs
  <span style="color: rgb(133, 153, 0);">def</span> <span style="color: rgb(38, 139, 210);">sum</span>(<span style="color: rgb(38, 139, 210);">n</span> : <span style="color: rgb(181, 137, 0);">Int*</span>)={
    n.sum
  }
}
</pre>
<pre class="src src-java" style="border: 1pt solid rgb(174, 189, 204); background-color: rgb(243, 245, 247); padding: 5pt; font-family: courier, monospace; font-size: small; overflow: auto; margin: 5px 10px;">
<span style="color: rgb(133, 153, 0);">public</span> <span style="color: rgb(133, 153, 0);">class</span> <span style="color: rgb(181, 137, 0);">Hello</span> {

    <span style="color: rgb(133, 153, 0);">public</span> <span style="color: rgb(133, 153, 0);">static</span> <span style="color: rgb(181, 137, 0);">void</span> <span style="color: rgb(38, 139, 210);">main</span>(<span style="color: rgb(181, 137, 0);">String</span>[] <span style="color: rgb(38, 139, 210);">args</span>){
        <span style="color: rgb(181, 137, 0);">Test</span> <span style="color: rgb(38, 139, 210);">t</span> = <span style="color: rgb(133, 153, 0);">new</span> <span style="color: rgb(181, 137, 0);">Test</span>();
        System.out.println(t.sum(1,2,3));
    }
}
</pre>
</p></div>
</div>
<div class="outline-3" id="outline-container-16-5" style="color: rgb(101, 122, 131); font-family: MONACO, 'trebuchet ms', arial, helvetica, sans-serif; font-size: 13px; line-height: normal; background-color: rgb(253, 246, 227);">
<h3 id="sec-16-5" style="margin: 5px 10px;">
		<span class="section-number-3">16.5</span>&nbsp;编写一个返回包含某文件所有行的字符串的方法。从Java调用该方法。<br />
	</h3>
<div class="outline-text-3" id="text-16-5">
<pre class="src src-scala" style="border: 1pt solid rgb(174, 189, 204); background-color: rgb(243, 245, 247); padding: 5pt; font-family: courier, monospace; font-size: small; overflow: auto; margin: 5px 10px;">
<span style="color: rgb(133, 153, 0);">import</span> io.Source

<span style="color: rgb(133, 153, 0);">class</span> <span style="color: rgb(181, 137, 0);">Test</span>{

  <span style="color: rgb(133, 153, 0);">def</span> <span style="color: rgb(38, 139, 210);">read</span>()={
    Source.fromFile(<span style="color: rgb(42, 161, 152);">&quot;test.txt&quot;</span>).mkString
  }
}
</pre>
<pre class="src src-java" style="border: 1pt solid rgb(174, 189, 204); background-color: rgb(243, 245, 247); padding: 5pt; font-family: courier, monospace; font-size: small; overflow: auto; margin: 5px 10px;">
<span style="color: rgb(133, 153, 0);">public</span> <span style="color: rgb(133, 153, 0);">class</span> <span style="color: rgb(181, 137, 0);">Hello</span> {
    <span style="color: rgb(133, 153, 0);">public</span> <span style="color: rgb(133, 153, 0);">static</span> <span style="color: rgb(181, 137, 0);">void</span> <span style="color: rgb(38, 139, 210);">main</span>(<span style="color: rgb(181, 137, 0);">String</span>[] <span style="color: rgb(38, 139, 210);">args</span>){
        <span style="color: rgb(181, 137, 0);">Test</span> <span style="color: rgb(38, 139, 210);">t</span> = <span style="color: rgb(133, 153, 0);">new</span> <span style="color: rgb(181, 137, 0);">Test</span>();
        System.out.println(t.read());
    }
}
</pre>
</p></div>
</div>
<div class="outline-3" id="outline-container-16-6" style="color: rgb(101, 122, 131); font-family: MONACO, 'trebuchet ms', arial, helvetica, sans-serif; font-size: 13px; line-height: normal; background-color: rgb(253, 246, 227);">
<h3 id="sec-16-6" style="margin: 5px 10px;">
		<span class="section-number-3">16.6</span>&nbsp;编写一个Scala对象，该对象带有一个易失(volatile)的Boolean字段。让某一个线程睡眠一段时间，之后将该字段设为true，打印消息，然后退出。而另一个线程不停的检查该字段是否为true。如果是，它将打印一个消息并退出。如果不是，则它将短暂睡眠，然后重试。如果变量不是易失的，会发生什么？<br />
	</h3>
<div class="outline-text-3" id="text-16-6">
<p style="margin: 5px 10px; text-indent: 40px;">
			这里只有一个线程修改Boolean字段，所以字段是否为volatile应该是没有区别的
		</p>
<pre class="src src-scala" style="border: 1pt solid rgb(174, 189, 204); background-color: rgb(243, 245, 247); padding: 5pt; font-family: courier, monospace; font-size: small; overflow: auto; margin: 5px 10px;">
<span style="color: rgb(133, 153, 0);">import</span> scala.actors.Actor

<span style="color: rgb(133, 153, 0);">class</span> <span style="color: rgb(181, 137, 0);">T1</span>(<span style="color: rgb(38, 139, 210);">obj</span>:<span style="color: rgb(181, 137, 0);">Obj</span>) <span style="color: rgb(133, 153, 0);">extends</span> <span style="color: rgb(181, 137, 0);">Actor</span>{
  <span style="color: rgb(133, 153, 0);">def</span> <span style="color: rgb(38, 139, 210);">act</span>() {
    println(<span style="color: rgb(42, 161, 152);">&quot;T1 is waiting&quot;</span>)
    Thread.sleep(5000)
    obj.flag = <span style="color: rgb(42, 161, 152);">true</span>
    println(<span style="color: rgb(42, 161, 152);">&quot;T1 set flag = true&quot;</span>)
  }
}

<span style="color: rgb(133, 153, 0);">class</span> <span style="color: rgb(181, 137, 0);">T2</span>(<span style="color: rgb(38, 139, 210);">obj</span>:<span style="color: rgb(181, 137, 0);">Obj</span>) <span style="color: rgb(133, 153, 0);">extends</span> <span style="color: rgb(181, 137, 0);">Actor</span>{
  <span style="color: rgb(133, 153, 0);">def</span> <span style="color: rgb(38, 139, 210);">act</span>() {
    <span style="color: rgb(133, 153, 0);">var</span> <span style="color: rgb(38, 139, 210);">f</span> = <span style="color: rgb(42, 161, 152);">true</span>
    <span style="color: rgb(133, 153, 0);">while</span> (f){
      <span style="color: rgb(133, 153, 0);">if</span>(obj.flag){
        println(<span style="color: rgb(42, 161, 152);">&quot;T2 is end&quot;</span>)
        f = <span style="color: rgb(42, 161, 152);">false</span>
      }<span style="color: rgb(133, 153, 0);">else</span>{
        println(<span style="color: rgb(42, 161, 152);">&quot;T2 is waiting&quot;</span>)
        Thread.sleep(1000)
      }
    }
  }
}

<span style="color: rgb(133, 153, 0);">class</span> <span style="color: rgb(181, 137, 0);">Obj</span>{
<span style="color: rgb(147, 161, 161); font-style: italic;">//  </span><span style="color: rgb(147, 161, 161); font-style: italic;">@volatile</span>
  <span style="color: rgb(133, 153, 0);">var</span> <span style="color: rgb(38, 139, 210);">flag</span> : <span style="color: rgb(181, 137, 0);">Boolean </span>= <span style="color: rgb(42, 161, 152);">false</span>
}

<span style="color: rgb(133, 153, 0);">object</span> <span style="color: rgb(38, 139, 210);">Test</span>{
  <span style="color: rgb(133, 153, 0);">def</span> <span style="color: rgb(38, 139, 210);">main</span>(<span style="color: rgb(38, 139, 210);">args</span>: <span style="color: rgb(181, 137, 0);">Array[String]</span>) {
    <span style="color: rgb(133, 153, 0);">val</span> <span style="color: rgb(38, 139, 210);">obj</span> = <span style="color: rgb(133, 153, 0);">new</span> Obj()
    <span style="color: rgb(133, 153, 0);">val</span> <span style="color: rgb(38, 139, 210);">t1</span> = <span style="color: rgb(133, 153, 0);">new</span> T1(obj)
    <span style="color: rgb(133, 153, 0);">val</span> <span style="color: rgb(38, 139, 210);">t2</span> = <span style="color: rgb(133, 153, 0);">new</span> T2(obj)
    t1.start()
    t2.start()
  }
}
</pre>
</p></div>
</div>
<div class="outline-3" id="outline-container-16-7" style="color: rgb(101, 122, 131); font-family: MONACO, 'trebuchet ms', arial, helvetica, sans-serif; font-size: 13px; line-height: normal; background-color: rgb(253, 246, 227);">
<h3 id="sec-16-7" style="margin: 5px 10px;">
		<span class="section-number-3">16.7</span>&nbsp;给出一个示例，展示如果方法可被重写，则尾递归优化为非法<br />
	</h3>
<div class="outline-text-3" id="text-16-7">
<pre class="src src-scala" style="border: 1pt solid rgb(174, 189, 204); background-color: rgb(243, 245, 247); padding: 5pt; font-family: courier, monospace; font-size: small; overflow: auto; margin: 5px 10px;">
<span style="color: rgb(133, 153, 0);">import</span> annotation.tailrec

<span style="color: rgb(133, 153, 0);">class</span> <span style="color: rgb(181, 137, 0);">Test</span>{
  @tailrec
  <span style="color: rgb(133, 153, 0);">def</span> <span style="color: rgb(38, 139, 210);">sum2</span>(<span style="color: rgb(38, 139, 210);">xs</span> : <span style="color: rgb(181, 137, 0);">Seq[Int]</span>,<span style="color: rgb(38, 139, 210);">partial</span> : <span style="color: rgb(181, 137, 0);">BigInt</span>) : <span style="color: rgb(181, 137, 0);">BigInt </span>= {
    <span style="color: rgb(133, 153, 0);">if</span> (xs.isEmpty) partial <span style="color: rgb(133, 153, 0);">else</span> sum2(xs.tail,xs.head + partial)
  }
}
</pre>
<p style="margin: 5px 10px; text-indent: 40px;">
			编译报错,修改如下
		</p>
<pre class="src src-scala" style="border: 1pt solid rgb(174, 189, 204); background-color: rgb(243, 245, 247); padding: 5pt; font-family: courier, monospace; font-size: small; overflow: auto; margin: 5px 10px;">
<span style="color: rgb(133, 153, 0);">import</span> annotation.tailrec

<span style="color: rgb(133, 153, 0);">object</span> <span style="color: rgb(38, 139, 210);">Test</span> <span style="color: rgb(133, 153, 0);">extends</span> <span style="color: rgb(181, 137, 0);">App</span>{
  @tailrec
  <span style="color: rgb(133, 153, 0);">def</span> <span style="color: rgb(38, 139, 210);">sum2</span>(<span style="color: rgb(38, 139, 210);">xs</span> : <span style="color: rgb(181, 137, 0);">Seq[Int]</span>,<span style="color: rgb(38, 139, 210);">partial</span> : <span style="color: rgb(181, 137, 0);">BigInt</span>) : <span style="color: rgb(181, 137, 0);">BigInt </span>= {
    <span style="color: rgb(133, 153, 0);">if</span> (xs.isEmpty) partial <span style="color: rgb(133, 153, 0);">else</span> sum2(xs.tail,xs.head + partial)
  }

  println(sum2(1 to 1000000,0))
}
</pre>
</p></div>
</div>
<div class="outline-3" id="outline-container-16-8" style="color: rgb(101, 122, 131); font-family: MONACO, 'trebuchet ms', arial, helvetica, sans-serif; font-size: 13px; line-height: normal; background-color: rgb(253, 246, 227);">
<h3 id="sec-16-8" style="margin: 5px 10px;">
		<span class="section-number-3">16.8</span>&nbsp;将allDifferent方法添加到对象，编译并检查字节码。@specialized注解产生了哪些方法?<br />
	</h3>
<div class="outline-text-3" id="text-16-8">
<pre class="src src-scala" style="border: 1pt solid rgb(174, 189, 204); background-color: rgb(243, 245, 247); padding: 5pt; font-family: courier, monospace; font-size: small; overflow: auto; margin: 5px 10px;">
<span style="color: rgb(133, 153, 0);">object</span> <span style="color: rgb(38, 139, 210);">Test</span>{
  <span style="color: rgb(133, 153, 0);">def</span> <span style="color: rgb(38, 139, 210);">allDifferent</span>[<span style="color: rgb(181, 137, 0);">@</span><span style="color: rgb(38, 139, 210);">specialized</span> <span style="color: rgb(38, 139, 210);">T]</span>(<span style="color: rgb(38, 139, 210);">x</span>:<span style="color: rgb(181, 137, 0);">T</span>,<span style="color: rgb(38, 139, 210);">y</span>:<span style="color: rgb(181, 137, 0);">T</span>,<span style="color: rgb(38, 139, 210);">z</span>:<span style="color: rgb(181, 137, 0);">T</span>) = x != y &amp;&amp; x!= z &amp;&amp; y != z
}
</pre>
<p style="margin: 5px 10px; text-indent: 40px;">
			javap Test$得到
		</p>
<pre class="src src-java" style="border: 1pt solid rgb(174, 189, 204); background-color: rgb(243, 245, 247); padding: 5pt; font-family: courier, monospace; font-size: small; overflow: auto; margin: 5px 10px;">
<span style="color: rgb(133, 153, 0);">public</span> <span style="color: rgb(133, 153, 0);">final</span> <span style="color: rgb(133, 153, 0);">class</span> <span style="color: rgb(181, 137, 0);">Test$</span> <span style="color: rgb(133, 153, 0);">extends</span> <span style="color: rgb(42, 161, 152);">java</span>.<span style="color: rgb(42, 161, 152);">lang</span>.<span style="color: rgb(181, 137, 0);">Object</span>{
    <span style="color: rgb(133, 153, 0);">public</span> <span style="color: rgb(133, 153, 0);">static</span> <span style="color: rgb(133, 153, 0);">final</span> <span style="color: rgb(181, 137, 0);">Test$</span> <span style="color: rgb(38, 139, 210);">MODULE$</span>;
    <span style="color: rgb(133, 153, 0);">public</span> <span style="color: rgb(133, 153, 0);">static</span> {};
    <span style="color: rgb(133, 153, 0);">public</span> <span style="color: rgb(181, 137, 0);">boolean</span> <span style="color: rgb(38, 139, 210);">allDifferent</span>(<span style="color: rgb(42, 161, 152);">java</span>.<span style="color: rgb(42, 161, 152);">lang</span>.<span style="color: rgb(181, 137, 0);">Object</span>, <span style="color: rgb(42, 161, 152);">java</span>.<span style="color: rgb(42, 161, 152);">lang</span>.<span style="color: rgb(181, 137, 0);">Object</span>, <span style="color: rgb(42, 161, 152);">java</span>.<span style="color: rgb(42, 161, 152);">lang</span>.<span style="color: rgb(181, 137, 0);">Ob</span>
<span style="color: rgb(38, 139, 210);">ject</span>);
    <span style="color: rgb(133, 153, 0);">public</span> <span style="color: rgb(181, 137, 0);">boolean</span> <span style="color: rgb(38, 139, 210);">allDifferent$mZc$sp</span>(<span style="color: rgb(181, 137, 0);">boolean</span>, <span style="color: rgb(181, 137, 0);">boolean</span>, <span style="color: rgb(181, 137, 0);">boolean</span>);
    <span style="color: rgb(133, 153, 0);">public</span> <span style="color: rgb(181, 137, 0);">boolean</span> <span style="color: rgb(38, 139, 210);">allDifferent$mBc$sp</span>(<span style="color: rgb(181, 137, 0);">byte</span>, <span style="color: rgb(181, 137, 0);">byte</span>, <span style="color: rgb(181, 137, 0);">byte</span>);
    <span style="color: rgb(133, 153, 0);">public</span> <span style="color: rgb(181, 137, 0);">boolean</span> <span style="color: rgb(38, 139, 210);">allDifferent$mCc$sp</span>(<span style="color: rgb(181, 137, 0);">char</span>, <span style="color: rgb(181, 137, 0);">char</span>, <span style="color: rgb(181, 137, 0);">char</span>);
    <span style="color: rgb(133, 153, 0);">public</span> <span style="color: rgb(181, 137, 0);">boolean</span> <span style="color: rgb(38, 139, 210);">allDifferent$mDc$sp</span>(<span style="color: rgb(181, 137, 0);">double</span>, <span style="color: rgb(181, 137, 0);">double</span>, <span style="color: rgb(181, 137, 0);">double</span>);
    <span style="color: rgb(133, 153, 0);">public</span> <span style="color: rgb(181, 137, 0);">boolean</span> <span style="color: rgb(38, 139, 210);">allDifferent$mFc$sp</span>(<span style="color: rgb(181, 137, 0);">float</span>, <span style="color: rgb(181, 137, 0);">float</span>, <span style="color: rgb(181, 137, 0);">float</span>);
    <span style="color: rgb(133, 153, 0);">public</span> <span style="color: rgb(181, 137, 0);">boolean</span> <span style="color: rgb(38, 139, 210);">allDifferent$mIc$sp</span>(<span style="color: rgb(181, 137, 0);">int</span>, <span style="color: rgb(181, 137, 0);">int</span>, <span style="color: rgb(181, 137, 0);">int</span>);
    <span style="color: rgb(133, 153, 0);">public</span> <span style="color: rgb(181, 137, 0);">boolean</span> <span style="color: rgb(38, 139, 210);">allDifferent$mJc$sp</span>(<span style="color: rgb(181, 137, 0);">long</span>, <span style="color: rgb(181, 137, 0);">long</span>, <span style="color: rgb(181, 137, 0);">long</span>);
    <span style="color: rgb(133, 153, 0);">public</span> <span style="color: rgb(181, 137, 0);">boolean</span> <span style="color: rgb(38, 139, 210);">allDifferent$mSc$sp</span>(<span style="color: rgb(181, 137, 0);">short</span>, <span style="color: rgb(181, 137, 0);">short</span>, <span style="color: rgb(181, 137, 0);">short</span>);
    <span style="color: rgb(133, 153, 0);">public</span> <span style="color: rgb(181, 137, 0);">boolean</span> <span style="color: rgb(38, 139, 210);">allDifferent$mVc$sp</span>(<span style="color: rgb(42, 161, 152);">scala</span>.<span style="color: rgb(42, 161, 152);">runtime</span>.<span style="color: rgb(181, 137, 0);">BoxedUnit</span>, <span style="color: rgb(42, 161, 152);">scala</span>.<span style="color: rgb(42, 161, 152);">runtime</span>.<span style="color: rgb(181, 137, 0);">Bo</span>
<span style="color: rgb(38, 139, 210);">xedUnit</span>, <span style="color: rgb(42, 161, 152);">scala</span>.<span style="color: rgb(42, 161, 152);">runtime</span>.<span style="color: rgb(181, 137, 0);">BoxedUnit</span>);
}
</pre>
</p></div>
</div>
<div class="outline-3" id="outline-container-16-9" style="color: rgb(101, 122, 131); font-family: MONACO, 'trebuchet ms', arial, helvetica, sans-serif; font-size: 13px; line-height: normal; background-color: rgb(253, 246, 227);">
<h3 id="sec-16-9" style="margin: 5px 10px;">
		<span class="section-number-3">16.9</span>&nbsp;Range.foreach方法被注解为@specialized(Unit)。为什么？通过以下命令检查字节码:<br />
	</h3>
<div class="outline-text-3" id="text-16-9">
<pre class="example" style="border: 1pt solid rgb(174, 189, 204); background-color: rgb(243, 245, 247); padding: 5pt; font-family: courier, monospace; font-size: small; overflow: auto; margin: 5px 10px;">
javap -classpath /path/to/scala/lib/scala-library.jar scala.collection.immutable.Range
</pre>
<p style="margin: 5px 10px; text-indent: 40px;">
			并考虑Function1上的@specialized注解。点击Scaladoc中的Function1.scala链接进行查看 首先来看Function1的源码
		</p>
<pre class="src src-scala" style="border: 1pt solid rgb(174, 189, 204); background-color: rgb(243, 245, 247); padding: 5pt; font-family: courier, monospace; font-size: small; overflow: auto; margin: 5px 10px;">
......
<span style="color: rgb(133, 153, 0);">trait</span> <span style="color: rgb(181, 137, 0);">Function1</span>[<span style="color: rgb(181, 137, 0);">@</span><span style="color: rgb(38, 139, 210);">specialized</span>(<span style="color: rgb(38, 139, 210);">scala.Int</span>, <span style="color: rgb(38, 139, 210);">scala.Long</span>, <span style="color: rgb(38, 139, 210);">scala.Float</span>, <span style="color: rgb(38, 139, 210);">scala.Double</span><span style="color: rgb(147, 161, 161); font-style: italic;">/*</span><span style="color: rgb(147, 161, 161); font-style: italic;">, scala.AnyRef*/</span>) <span style="color: rgb(38, 139, 210);">-T1</span>, <span style="color: rgb(38, 139, 210);">@specialized</span>(<span style="color: rgb(38, 139, 210);">scala.Unit</span>, <span style="color: rgb(38, 139, 210);">scala.Boolean</span>, <span style="color: rgb(38, 139, 210);">scala.Int</span>, <span style="color: rgb(38, 139, 210);">scala.Float</span>, <span style="color: rgb(38, 139, 210);">scala.Long</span>, <span style="color: rgb(38, 139, 210);">scala.Double</span><span style="color: rgb(147, 161, 161); font-style: italic;">/*</span><span style="color: rgb(147, 161, 161); font-style: italic;">, scala.AnyRef*/</span>) <span style="color: rgb(38, 139, 210);">+R]</span> <span style="color: rgb(133, 153, 0);">extends</span> <span style="color: rgb(181, 137, 0);">AnyRef</span> { self =&gt;
  <span style="color: rgb(147, 161, 161); font-style: italic;">/** </span><span style="color: rgb(147, 161, 161); font-style: italic;">Apply the body of this function to the argument.</span>
<span style="color: rgb(147, 161, 161); font-style: italic;">   *  @return   the result of function application.</span>
<span style="color: rgb(147, 161, 161); font-style: italic;">   */</span>
  <span style="color: rgb(133, 153, 0);">def</span> <span style="color: rgb(38, 139, 210);">apply</span>(<span style="color: rgb(38, 139, 210);">v1</span>: <span style="color: rgb(181, 137, 0);">T1</span>): <span style="color: rgb(181, 137, 0);">R</span>
......
</pre>
<p style="margin: 5px 10px; text-indent: 40px;">
			可以看到Function1参数可以是scala.Int,scala.Long,scala.Float,scala.Double，返回值可以是scala.Unit,scala.Boolean,scala.Int,scala.Float,scala.Long,scala.Double 再来看Range.foreach的源码
		</p>
<pre class="src src-scala" style="border: 1pt solid rgb(174, 189, 204); background-color: rgb(243, 245, 247); padding: 5pt; font-family: courier, monospace; font-size: small; overflow: auto; margin: 5px 10px;">
...... 
@inline <span style="color: rgb(133, 153, 0);">final</span> <span style="color: rgb(133, 153, 0);">override</span> <span style="color: rgb(133, 153, 0);">def</span> <span style="color: rgb(38, 139, 210);">foreach</span>[<span style="color: rgb(181, 137, 0);">@</span><span style="color: rgb(38, 139, 210);">specialized</span>(<span style="color: rgb(38, 139, 210);">Unit</span>) <span style="color: rgb(38, 139, 210);">U]</span>(<span style="color: rgb(38, 139, 210);">f</span>: <span style="color: rgb(181, 137, 0);">Int =&gt; U</span>) {
    <span style="color: rgb(133, 153, 0);">if</span> (validateRangeBoundaries(f)) {
      <span style="color: rgb(133, 153, 0);">var</span> <span style="color: rgb(38, 139, 210);">i</span> = start
      <span style="color: rgb(133, 153, 0);">val</span> <span style="color: rgb(38, 139, 210);">terminal</span> = terminalElement
      <span style="color: rgb(133, 153, 0);">val</span> <span style="color: rgb(38, 139, 210);">step</span> = <span style="color: rgb(133, 153, 0);">this</span>.step
      <span style="color: rgb(133, 153, 0);">while</span> (i != terminal) {
        f(i)
        i += step
      }
    }
  }
......
</pre>
<p style="margin: 5px 10px; text-indent: 40px;">
			首先此方法是没有返回值的，也就是Unit。而Function1的返回值可以是scala.Unit,scala.Boolean,scala.Int,scala.Float,scala.Long,scala.Double 如果不限定@specialized(Unit),则Function1可能返回其他类型，但是此方法体根本就不返回，即使设置了也无法获得返回值
		</p>
</p></div>
</div>
<div class="outline-3" id="outline-container-16-10" style="color: rgb(101, 122, 131); font-family: MONACO, 'trebuchet ms', arial, helvetica, sans-serif; font-size: 13px; line-height: normal; background-color: rgb(253, 246, 227);">
<h3 id="sec-16-10" style="margin: 5px 10px;">
		<span class="section-number-3">16.10</span>&nbsp;添加assert(n &gt;= 0)到factorial方法。在启用断言的情况下编译并校验factorial(-1)会抛异常。在禁用断言的情况下编译。会发生什么？用javap检查该断言调用<br />
	</h3>
<div class="outline-text-3" id="text-16-10">
<pre class="src src-scala" style="border: 1pt solid rgb(174, 189, 204); background-color: rgb(243, 245, 247); padding: 5pt; font-family: courier, monospace; font-size: small; overflow: auto; margin: 5px 10px;">
<span style="color: rgb(133, 153, 0);">object</span> <span style="color: rgb(38, 139, 210);">Test</span> {
  <span style="color: rgb(133, 153, 0);">def</span> <span style="color: rgb(38, 139, 210);">factorial</span>(<span style="color: rgb(38, 139, 210);">n</span>: <span style="color: rgb(181, 137, 0);">Int</span>): <span style="color: rgb(181, 137, 0);">Int </span>= {
    assert(n &gt; 0)
    n
  }

  <span style="color: rgb(133, 153, 0);">def</span> <span style="color: rgb(38, 139, 210);">main</span>(<span style="color: rgb(38, 139, 210);">args</span>: <span style="color: rgb(181, 137, 0);">Array[String]</span>) {
    factorial(-1)
  }
}
</pre>
<p style="margin: 5px 10px; text-indent: 40px;">
			编译报错
		</p>
<pre class="example" style="border: 1pt solid rgb(174, 189, 204); background-color: rgb(243, 245, 247); padding: 5pt; font-family: courier, monospace; font-size: small; overflow: auto; margin: 5px 10px;">
Exception in thread &quot;main&quot; java.lang.AssertionError: assertion failed
        at scala.Predef$.assert(Predef.scala:165)
        at Test$.factorial(Test.scala:6)
        at Test$.main(Test.scala:11)
        at Test.main(Test.scala)
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
        at java.lang.reflect.Method.invoke(Method.java:597)
        at com.intellij.rt.execution.application.AppMain.main(AppMain.java:120)
</pre>
<p style="margin: 5px 10px; text-indent: 40px;">
			禁用assert
		</p>
<pre class="example" style="border: 1pt solid rgb(174, 189, 204); background-color: rgb(243, 245, 247); padding: 5pt; font-family: courier, monospace; font-size: small; overflow: auto; margin: 5px 10px;">
-Xelide-below 2011
</pre>
<p style="margin: 5px 10px; text-indent: 40px;">
			反编译此类javap -c Test$ 得到
		</p>
<pre class="src src-java" style="border: 1pt solid rgb(174, 189, 204); background-color: rgb(243, 245, 247); padding: 5pt; font-family: courier, monospace; font-size: small; overflow: auto; margin: 5px 10px;">
......
<span style="color: rgb(133, 153, 0);">public</span> <span style="color: rgb(181, 137, 0);">int</span> factorial(<span style="color: rgb(181, 137, 0);">int</span>);
  <span style="color: rgb(42, 161, 152);">Code</span>:
   0:   getstatic       #19; <span style="color: rgb(147, 161, 161); font-style: italic;">//</span><span style="color: rgb(147, 161, 161); font-style: italic;">Field scala/Predef$.MODULE$:Lscala/Predef$;</span>
   3:   iload_1
   4:   iconst_0
   5:   if_icmple       12
   8:   iconst_1
   9:   <span style="color: rgb(133, 153, 0);">goto</span>    13
   12:  iconst_0
   13:  invokevirtual   #23; <span style="color: rgb(147, 161, 161); font-style: italic;">//</span><span style="color: rgb(147, 161, 161); font-style: italic;">Method scala/Predef$.assert:(Z)V</span>
   16:  iload_1
   17:  ireturn
......</pre>
</p></div>
</div>

</div>

    <div class="pure-g pagination">
        
        <a class="pure-u-1-2 pagination-item " href="/java-scala/%25e5%25bf%25ab%25e5%25ad%25a6scala%25e4%25b9%25a0%25e9%25a2%2598%25e8%25a7%25a3%25e7%25ad%2594-%25e7%25ac%25ac%25e5%258d%2581%25e5%259b%259b%25e7%25ab%25a0-%25e6%25a8%25a1%25e5%25bc%258f%25e5%258c%25b9%25e9%2585%258d%25e5%2592%258c%25e6%25a0%25b7%25e4%25be%258b%25e7%25b1%25bb.html" title="快学Scala习题解答—第十四章 模式匹配和样例类 "><p> <i class="fa fa-mail-reply"></i>&nbsp;快学Scala习题解答—第十四章 模式匹配和样例类</p></a>
        
        
        <a class="pure-u-1-2 pagination-item " href="/java-scala/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/javascala%25e6%25af%2594%25e8%25be%2583-%25e8%25ae%25be%25e8%25ae%25a1%25e6%25a8%25a1%25e5%25bc%258fsingleton.html" title="Java&Scala比较---设计模式(Singleton)"><p>Java&Scala比较---设计模式(Singleton)&nbsp;<i class="fa fa-mail-forward"></i></p></a>
        
    </div>
    <link href="/css/code.css" rel="stylesheet">
    <link href="/css/min/fancybox.css" rel="stylesheet">
    <script src="/js/min/jquery.toc.min.js" ></script>
    <script src="/js/min/jquery.qrcode.min.js" ></script>
    <script src="/js/min/jquery.fancybox.pack.js" ></script>
    <script src="/js/page.js" ></script>

    
    

    
    
    <a name="comments"> </a>
<div id="comment">
    <div class="ds-thread" data-title="快学Scala习题解答—第十五章 注解"></div>
    <script type="text/javascript">
        var duoshuoQuery = {short_name:""};
        (function() {
            var ds = document.createElement('script');
            ds.type = 'text/javascript';ds.async = true;
            ds.src = '../js/min/duoshuo.js';
            ds.charset = 'UTF-8';
            (document.getElementsByTagName('head')[0]
                    || document.getElementsByTagName('body')[0]).appendChild(ds);
        })();
    </script>
</div>

    






            </div>
            </div>
        <div class="footer">
                <a href="/love/welcome-my-blog.html">About</a>
                 <a href="/1">Collecting</a>
                <a href="tencent://message/?uin=561802774">QQ</a>
                <a href="https://github.com/ivanpig">GitHub</a>
            <script src="/js/min/nprogress.min.js"></script>
            <script src="/js/index.js"></script>
        </div>
        <div class="topfade"><a href="javascript:;" title="返回顶部"></a></div>

    </div>

</div>

</body>

</html>
